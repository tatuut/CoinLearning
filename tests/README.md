# 🧪 テストスクリプト

## 📋 全体テスト

システム全体の動作を確認：

```bash
python tests/test_all.py
```

## ✅ テスト項目

### 1. モジュールインポートテスト
- 全モジュールが正常にインポートできるか確認

### 2. データベース接続テスト
- SQLite データベースに接続できるか
- 主要テーブルが存在するか
- データが保存されているか

### 3. Parquetストレージテスト
- Parquetファイルが正しく保存されているか
- ファイルが読み込めるか
- データ構造が正しいか

### 4. 指標プラグインシステムテスト
- 指標が自動的にロードされるか
- 各指標が正常に計算できるか

### 5. API接続テスト
- MEXC APIに接続できるか
- 価格データを取得できるか
- 24h統計を取得できるか

## 📊 期待される出力

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                         システム統合テスト                                   ║
╚══════════════════════════════════════════════════════════════════════════════╝

================================================================================
📦 モジュールインポートテスト
================================================================================
✅ 全5個のモジュールが正常

================================================================================
🗄️ データベース接続テスト
================================================================================
✓ データベース接続成功
✓ テーブル数: 13
  主要テーブル:
    - price_history_detailed: 1050行
    - news: 61行
    - market_stats_detailed: 1行

================================================================================
📊 Parquetストレージテスト
================================================================================
✓ Parquetディレクトリ: .../data/timeseries/prices
✓ ファイル数: 10
  ファイル一覧:
    - BTC_1d.parquet (5.3 KB)
    - BTC_4h.parquet (10.4 KB)
    ...

================================================================================
🔌 指標プラグインシステムテスト
================================================================================
✓ ロードされた指標数: 3

利用可能な指標:
  - ATR（Average True Range） (atr)
  - OBV（On Balance Volume） (obv)
  - ストキャスティクス (stochastic)

計算テスト（BTC 1d）:
  ✓ ATR（Average True Range）: 計算成功
  ✓ OBV（On Balance Volume）: 計算成功
  ✓ ストキャスティクス: 計算成功

================================================================================
🌐 MEXC API接続テスト
================================================================================
✓ BTC価格取得: $107,012.85
✓ 24h統計取得: 変動率 +0.01%

================================================================================
📊 テスト結果サマリー
================================================================================
✅ 合格: モジュールインポート
✅ 合格: データベース接続
✅ 合格: Parquetストレージ
✅ 合格: 指標プラグイン
✅ 合格: API接続

合計: 5/5 テスト合格

🎉 全テスト合格！システムは正常に動作しています。
```

## 🔧 トラブルシューティング

### テストが失敗する場合

**1. モジュールインポート失敗**
- 必要なパッケージがインストールされているか確認
  ```bash
  pip install requests numpy pandas pyarrow
  ```

**2. データベース接続失敗**
- `data/advanced_trading.db` が存在するか確認
- まずデータ収集を実行：
  ```bash
  python data/detailed_data_collector.py BTC --all-intervals
  ```

**3. Parquetストレージ失敗**
- Parquetファイルが存在しない場合は移行を実行：
  ```bash
  python data/timeseries_storage.py --migrate
  ```

**4. 指標プラグイン失敗**
- `analysis/indicators/` ディレクトリに指標ファイルが存在するか確認
- 各指標ファイルに `calculate()` 関数があるか確認

**5. API接続失敗**
- インターネット接続を確認
- MEXC APIが稼働しているか確認

## 📝 個別テストの追加方法

`tests/` ディレクトリに新しいテストファイルを追加できます：

```python
# tests/test_my_feature.py

def test_my_feature():
    """あなたの機能のテスト"""
    # テストロジック
    assert True

if __name__ == '__main__':
    test_my_feature()
    print("✅ テスト成功")
```

## 🚀 継続的テスト

開発中は定期的にテストを実行することを推奨：

```bash
# 変更を加えたら毎回実行
python tests/test_all.py

# 問題なければコミット
git add .
git commit -m "機能追加 - テスト済み"
```
