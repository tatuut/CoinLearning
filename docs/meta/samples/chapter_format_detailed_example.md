# 📖 Chapter形式の詳細サンプル

このファイルは、技術習得ストーリー（Chapter形式）の作成方法を示す詳細な記載例です。

**ベース**: `curriculum/stories/02_rsi_invention.md`（RSIの発明ストーリー）

---

## 🎯 Chapter形式の目的

**Who**: 技術の「なぜ」「どうやって」を深く理解したい学習者
**What**: 技術が発明された背景、数式の意味、実装方法、使い方を物語で学ぶ
**Why**: 暗記ではなく理解することで、応用力と判断力を身につける

---

## 📋 Chapter形式の12シーン構成

### 【ストーリーパート】発明者の物語（Scene 1-5）

#### Scene 1: 時代背景と発明者の登場
**目的**: 読者をその時代に引き込み、発明者に共感させる

```markdown
## Scene 1: 1978年、ニューオーリンズ

**ミコ**: 「ユウタ、1978年にタイムスリップするぞ」

**ユウタ**: 「は？」

**ミコ**: 「RSI（Relative Strength Index）を発明した男、J・ウェルズ・ワイルダー・ジュニアの話だ」

---

### 【回想シーン: ワイルダーの悩み】

**場所**: ルイジアナ州ニューオーリンズ、自宅の書斎

**ワイルダー** (45歳、機械エンジニア出身のトレーダー):
「くそっ...また負けた」

*チャートを睨みつける。商品先物（大豆）のチャートだ。*

**ワイルダー**: 「価格が急騰してるから買った。そしたら翌日暴落...」

**ワイルダー**: 「なぜだ？なぜ俺が買った瞬間に下がる？」

*机の上には数ヶ月分のトレード記録。ほとんどが赤字。*

**ワイルダー**: 「...待てよ」

**ワイルダー**: 「急騰してる時に買ったから負けたんじゃないか？」

**ワイルダー**: 「つまり、『買われすぎ』の時に買ってしまった？」
```

**ポイント**:
- ✅ 具体的な時代（1978年）、場所（ニューオーリンズ）
- ✅ 発明者の背景（機械エンジニア → トレーダー）
- ✅ 失敗体験（共感ポイント）
- ✅ 問題意識の芽生え（「買われすぎ」という概念）

---

#### Scene 2: 着想の瞬間
**目的**: 発明者の専門知識が活きる瞬間を描く

```markdown
## Scene 2: エンジニアの着想

**ワイルダー**: 「機械工学で考えろ...」

**ワイルダー**: 「エンジンの回転数が『正常範囲』を超えたら、オーバーヒートする」

**ワイルダー**: 「株価も同じじゃないのか？」

【ワイルダーのノート】

仮説:
価格には「正常範囲」がある
→ 範囲を超えて上昇 = 過熱（買われすぎ）
→ 範囲を超えて下落 = 冷却（売られすぎ）

問題:
「正常範囲」をどう定義する？

エンジン: 回転数（RPM）で測定可能
株価: ？？？

**ワイルダー**: 「価格そのものじゃダメだ...」

**ワイルダー**: 「$10から$20に上がるのと、$100から$110に上がるのは、意味が違う」

**ワイルダー**: 「必要なのは...**相対的な強さ**だ」
```

**ポイント**:
- ✅ 専門分野の知識を応用（エンジン → 株価）
- ✅ アナロジー思考（類推）
- ✅ 問題の本質を見抜く（絶対値ではなく相対値）

---

#### Scene 3: 数式の誕生
**目的**: 試行錯誤のプロセスを可視化し、数式の必然性を示す

```markdown
## Scene 3: 数式の誕生

**ワイルダー**: （ペンを走らせる）

【思考プロセス】

Step 1: 上昇と下落を分離
- 上昇幅 = 今日の終値 - 昨日の終値（正の時のみ）
- 下落幅 = 昨日の終値 - 今日の終値（負の時のみ）

Step 2: 平均を取る
- 平均上昇幅 = 過去14日間の上昇幅の平均
- 平均下落幅 = 過去14日間の下落幅の平均

Step 3: 比率を計算
- RS (Relative Strength) = 平均上昇幅 / 平均下落幅

問題: RSは0～∞の範囲。見づらい...

Step 4: 0-100に正規化
- RSI = 100 - (100 / (1 + RS))

→ これだ！

**ワイルダー**: 「できた...」

**ワイルダー**: （震える手で過去のチャートにRSIを計算）

**ワイルダー**: 「...70を超えてる時に買って、全部負けてる」

**ワイルダー**: 「30を下回ってる時に買ってたら...全部勝ってる！」

**ワイルダー**: 「これだ！**これが答えだ！**」
```

**ポイント**:
- ✅ Step-by-stepの思考プロセス
- ✅ 各Stepの理由
- ✅ 問題発見と解決（0-∞ → 0-100への正規化）
- ✅ バックテストによる検証

---

#### Scene 4: 出版と影響
**目的**: 技術が世に広まった経緯を示す

```markdown
## Scene 4: 1978年6月、伝説の出版

**ナレーション**:
1978年6月、ワイルダーは自費出版で『New Concepts in Technical Trading Systems』を発表。

その中で、RSIは世界で初めて紹介された。

**本の中の一節**:
> "RSIは0から100の範囲で動く。70を超えたら買われすぎ、30を下回ったら売られすぎを示す。"

**ナレーション**:
この本は、テクニカル分析の歴史を変えた。

RSIは瞬く間に世界中のトレーダーに広まり、今日でも最も使われる指標の一つとなっている。
```

**ポイント**:
- ✅ 歴史的事実（1978年6月、自費出版）
- ✅ 原典からの引用
- ✅ インパクト（歴史を変えた）

---

#### Scene 5: 現代への接続
**目的**: ストーリーを現代に戻し、実践パートへ繋ぐ

```markdown
## Scene 5: 現代、ユウタとミコ

**ユウタ**: 「...すげえ」

**ミコ**: 「ワイルダーは、何度も負けて、悩んで、この数式にたどり着いた」

**ユウタ**: 「機械工学の知識を使ったのか」

**ミコ**: 「そう。『正常範囲』という概念を、株価に応用した」

**ミコ**: 「じゃあ、実際にやってみるぞ」
```

**ポイント**:
- ✅ 教訓のまとめ（何度も負けて考え抜いた）
- ✅ 実践への橋渡し

---

### 【実装パート】現代での実装（Scene 6-9）

#### Scene 6: Pythonでの実装
**目的**: 数式をコードに落とし込む過程を示す

```markdown
## Scene 6: RSIの実装

**ミコ**: 「Pythonで書くとこうなる」

\```python
def calculate_rsi(prices: pd.Series, period: int = 14) -> pd.Series:
    """
    RSI（Relative Strength Index）を計算

    Args:
        prices: 終値のSeries
        period: 期間（デフォルト14日）

    Returns:
        RSIのSeries（0-100）
    """
    # Step 1: 日次変動を計算
    delta = prices.diff()

    # Step 2: 上昇と下落に分離
    gain = delta.where(delta > 0, 0)  # 上昇分のみ
    loss = -delta.where(delta < 0, 0)  # 下落分のみ（正の値に）

    # Step 3: 平均を計算（ワイルダーの移動平均）
    avg_gain = gain.rolling(window=period).mean()
    avg_loss = loss.rolling(window=period).mean()

    # Step 4: RS（Relative Strength）を計算
    rs = avg_gain / avg_loss

    # Step 5: RSI（0-100に正規化）
    rsi = 100 - (100 / (1 + rs))

    return rsi
\```

**ユウタ**: 「これだけ？」

**ミコ**: 「これだけだ。シンプルだろ？」
```

**ポイント**:
- ✅ コメントでStep番号を明示（Scene 3の思考プロセスと対応）
- ✅ 各行の意味を説明
- ✅ シンプルさを強調

---

#### Scene 7: 実データでの検証
**目的**: 理論を実践で確かめる

```markdown
## Scene 7: SHIBでの検証

**ミコ**: 「じゃあ、Week 1で負けたSHIBで確認してみよう」

\```python
# SHIBの価格データ取得
shib_df = timeseries_manager.get_data('SHIB')

# RSI計算
shib_df['rsi'] = calculate_rsi(shib_df['close'])

# ユウタが買った日
buy_date = '2025-10-18 15:30'

print(f"購入日のRSI: {shib_df.loc[buy_date, 'rsi']:.1f}")
\```

**出力**:
\```
購入日のRSI: 68.3
\```

**ユウタ**: 「68.3...」

**ミコ**: 「70に近い。『買われすぎ』の領域だ」

**ユウタ**: 「だから、買った後に下がったのか...」
```

**ポイント**:
- ✅ 実際の失敗例で検証（Week 1のSHIB）
- ✅ 数値と解釈をセットで
- ✅ 納得感（「だから失敗したのか」）

---

#### Scene 8: 応用的な使い方
**目的**: 基本を超えた活用法を示す

```markdown
## Scene 8: RSIの3つの使い方

**ミコ**: 「RSIには、3つの基本的な使い方がある」

【RSIの3つの使い方】

## 1. 買われすぎ/売られすぎ判定
- RSI > 70: 買われすぎ → 売りシグナル（または買わない）
- RSI < 30: 売られすぎ → 買いシグナル

## 2. ダイバージェンス（逆行現象）
価格: 高値更新
RSI: 高値更新せず → 弱気ダイバージェンス（下落の予兆）

価格: 安値更新
RSI: 安値更新せず → 強気ダイバージェンス（上昇の予兆）

## 3. トレンド確認
強い上昇トレンド: RSIが40-80の範囲で推移
強い下降トレンド: RSIが20-60の範囲で推移

**ユウタ**: 「70/30だけじゃないのか」

**ミコ**: 「そう。でも、最初は70/30だけで十分」
```

**ポイント**:
- ✅ 3つの使い方を明示
- ✅ 初心者へのアドバイス（最初は基本だけ）

---

#### Scene 9: 限界と弱点
**目的**: 万能ではないことを正直に伝える

```markdown
## Scene 9: RSIの弱点

**ミコ**: 「ただし、RSIには弱点がある」

**ユウタ**: 「なに？」

**ミコ**: 「**強いトレンド相場では役に立たない**」

【RSIの弱点】

## 問題1: トレンド相場での誤シグナル
強い上昇トレンド:
- RSI > 70が長期間続く
- 「買われすぎ」だが、まだ上がる
- 売ると機会損失

強い下降トレンド:
- RSI < 30が長期間続く
- 「売られすぎ」だが、まだ下がる
- 買うと損失

## 問題2: レンジ相場専用
RSIは「往復する相場」で最も有効
一方向に動く相場では機能しない

## 問題3: 期間の選択
14日: ワイルダーの標準
7日: 短期トレード向け（敏感）
21日: 長期トレード向け（鈍感）

→ どれが正解？

**ユウタ**: 「じゃあ、どう使えばいいの？」

**ミコ**: 「**他の指標と組み合わせる**」
```

**ポイント**:
- ✅ 正直に弱点を伝える
- ✅ どんな場面で失敗するか具体的に
- ✅ 解決策（他指標との組み合わせ）

---

### 【統合パート】ユウタ式での活用（Scene 10-11）

#### Scene 10: ユウタ式戦略への組み込み
**目的**: この技術を自分たちの戦略にどう組み込むか

```markdown
## Scene 10: ユウタ式での使い方

**ミコ**: 「俺たちの戦略『ユウタ式スイングトレード』では、こう使う」

【ユウタ式でのRSI活用法】

## エントリー判断
✅ RSI < 30: 売られすぎ → 反発狙いで買い検討
✅ RSI 30-50: 中立 → トレンド確認後、買い検討
❌ RSI > 70: 買われすぎ → 買わない（待つ）

## イグジット判断
✅ RSI > 70: 過熱 → 利確検討
✅ RSI < 30（買い後）: 弱すぎ → 損切り検討

## 使わない場面
- ニュースで大きく動いた直後（ファンダ優先）
- 強いトレンドが明確な時（トレンドフォロー優先）

## 組み合わせ
RSI単体では判断しない
→ 必ず「ニュース」「トレンド」「出来高」も確認

**ユウタ**: 「あくまで『補助』なんだな」

**ミコ**: 「そう。RSIは**フィルター**だ」

**ミコ**: 「『明らかに買われすぎ』を避けるためのツール」
```

**ポイント**:
- ✅ 戦略への明確な位置づけ
- ✅ ルールを具体的に（RSI < 30なら○○）
- ✅ 使わない場面も明示

---

#### Scene 11: 実装コード（完全版）
**目的**: プロダクションレベルのコードを提供

```markdown
## Scene 11: 実装コード

**ミコ**: 「じゃあ、実際のコードに組み込もう」

\```python
# tools/technical_indicators.py

import pandas as pd
import numpy as np


class TechnicalIndicators:
    """テクニカル指標計算クラス"""

    @staticmethod
    def rsi(prices: pd.Series, period: int = 14) -> pd.Series:
        """
        RSI（Relative Strength Index）

        発明者: J. Welles Wilder Jr. (1978)
        用途: 買われすぎ/売られすぎ判定

        Args:
            prices: 終値のSeries
            period: 期間（デフォルト14）

        Returns:
            RSI (0-100)
        """
        delta = prices.diff()

        gain = delta.where(delta > 0, 0)
        loss = -delta.where(delta < 0, 0)

        avg_gain = gain.rolling(window=period).mean()
        avg_loss = loss.rolling(window=period).mean()

        rs = avg_gain / avg_loss
        rsi = 100 - (100 / (1 + rs))

        return rsi

    @staticmethod
    def interpret_rsi(rsi_value: float) -> dict:
        """
        RSI値を解釈

        Args:
            rsi_value: RSI値（0-100）

        Returns:
            {
                'status': 'oversold' | 'neutral' | 'overbought',
                'signal': 'buy' | 'hold' | 'sell',
                'strength': 0.0-1.0,
                'description': '説明文'
            }
        """
        if rsi_value < 30:
            return {
                'status': 'oversold',
                'signal': 'buy',
                'strength': (30 - rsi_value) / 30,  # 0に近いほど強い
                'description': f'売られすぎ（RSI={rsi_value:.1f}）。反発の可能性あり。'
            }
        elif rsi_value > 70:
            return {
                'status': 'overbought',
                'signal': 'sell',
                'strength': (rsi_value - 70) / 30,  # 100に近いほど強い
                'description': f'買われすぎ（RSI={rsi_value:.1f}）。調整の可能性あり。'
            }
        else:
            return {
                'status': 'neutral',
                'signal': 'hold',
                'strength': 1 - abs(rsi_value - 50) / 20,  # 50に近いほど中立
                'description': f'中立（RSI={rsi_value:.1f}）。トレンド確認が必要。'
            }
\```

**ユウタ**: 「これで、RSIが使えるようになった！」

**ミコ**: 「まだ一つだけだ。次はもっと強力な武器を手に入れる」
```

**ポイント**:
- ✅ プロダクションレベルのコード（docstring、型ヒント）
- ✅ 解釈関数（interpret_rsi）で使いやすく
- ✅ 次への伏線

---

### 【まとめパート】振り返りと次へ（Scene 12）

#### Scene 12: エピローグ
**目的**: 学びを振り返り、次のChapterへ繋ぐ

```markdown
## Scene 12: エピローグ

**ユウタ**: 「ワイルダーって天才だな」

**ミコ**: 「天才じゃない。**何度も負けて、考え抜いた人**だ」

**ユウタ**: 「俺たちと同じか」

**ミコ**: 「そう。俺たちも、同じように武器を手に入れていく」

**ミコ**: 「次は...『トレンドの方向』を教えてくれる武器だ」

---

## 📝 Chapter 2 まとめ

### RSI（Relative Strength Index）

【発明】
- 発明者: J. Welles Wilder Jr.
- 発表: 1978年6月
- 動機: 「買われすぎ/売られすぎ」を数値化したい

【計算式】
RSI = 100 - (100 / (1 + RS))
RS = 平均上昇幅 / 平均下落幅（14日間）

【解釈】
- RSI > 70: 買われすぎ
- RSI < 30: 売られすぎ
- RSI 30-70: 中立

【使い方（ユウタ式）】
- エントリー: RSI < 30で反発狙い
- イグジット: RSI > 70で利確検討
- フィルター: RSI > 70では買わない

【弱点】
- 強いトレンド相場では誤シグナル
- 単体では不十分（他指標と組み合わせ）

### 実装完了

✅ `tools/technical_indicators.py`
- `rsi()`: RSI計算
- `interpret_rsi()`: RSI解釈
- `detect_divergence()`: ダイバージェンス検出

---

**Next Chapter**: [Chapter 3: MACDの誕生 - トレンドを「見える化」した男](./03_macd_invention.md)
```

**ポイント**:
- ✅ 天才神話の否定（何度も失敗した普通の人）
- ✅ 次への伏線（トレンド分析）
- ✅ まとめボックス（発明、計算式、解釈、使い方、弱点）
- ✅ 実装完了リスト
- ✅ Next Chapterリンク

---

## 📊 Chapter形式の重要ポイント

### 1. ストーリーパート（Scene 1-5）のコツ

✅ **具体性**
- × 「昔、ある人がRSIを発明した」
- ○ 「1978年、ニューオーリンズで、45歳の機械エンジニア出身トレーダー、J・ウェルズ・ワイルダー・ジュニアがRSIを発明した」

✅ **共感ポイント**
- 発明者も最初は失敗していた
- 同じ問題に直面していた
- 試行錯誤の末にたどり着いた

✅ **専門知識の転用**
- ワイルダー: 機械工学 → 株価分析（正常範囲の概念）
- アペル: 平滑化技術 → トレンド分析（EMA）
- ボリンジャー: 統計学 → ボラティリティ可視化（標準偏差）

### 2. 実装パート（Scene 6-9）のコツ

✅ **段階的な説明**
1. シンプルな実装（Scene 6）
2. 実データでの検証（Scene 7）
3. 応用的な使い方（Scene 8）
4. 限界と弱点（Scene 9）

✅ **正直さ**
- 万能ではないことを明示
- どんな場面で失敗するか具体的に
- 解決策も提示（他指標との組み合わせ）

### 3. 統合パート（Scene 10-11）のコツ

✅ **戦略への組み込み**
- ユウタ式スイングトレードでの位置づけ
- 具体的なルール（RSI < 30なら○○）
- 使わない場面も明示

✅ **プロダクションコード**
- docstring完備
- 型ヒント
- 解釈関数（interpret_xxx）で使いやすく

### 4. まとめパート（Scene 12）のコツ

✅ **教訓の明確化**
- 天才神話の否定
- 努力と試行錯誤の強調
- 読者への励まし

✅ **次への接続**
- 次のChapterへの伏線
- まとめボックスで復習
- リンクで移動しやすく

---

## 🔗 関連ファイル

- Week形式の詳細サンプル: [week_format_detailed_example.md](./week_format_detailed_example.md)
- カリキュラム作成ガイド: [../curriculum_creation_guide.md](../curriculum_creation_guide.md)
- 実際のChapter例: [../../curriculum/stories/02_rsi_invention.md](../../curriculum/stories/02_rsi_invention.md)
