# Week 4: カスタム指標とバックテスト - 自動化への道

## このWeekの概要

Week 3までで、「材料収集」「技術分析」「ポートフォリオ思考」という投資の基礎を学びました。しかし、毎回手動で分析するのは時間がかかります。Week 4では、**自分だけのカスタム指標を作り**、**バックテストで検証し**、**半自動化**を実現します。

ユウタは現在110円の資金を持っています。今週は、`analysis/indicators/`プラグインシステムを使って独自の指標を作成し、過去データで検証することで、「自分だけの必勝パターン」を見つけます。

また、毎回のスキャン作業を効率化するスクリプトを作成し、分析時間を3時間から10分に短縮します。

## 最終ゴール

このWeekが終わった時点でできること：

1. **カスタム指標を作成できる**
   - `analysis/indicators/`にファイルを追加するだけ
   - 自分だけの売買ルールを実装
   - 既存指標を組み合わせた複合指標

2. **バックテストで検証できる**
   - 過去30日のデータで戦略をテスト
   - 勝率、平均リターン、最大ドローダウンを計算
   - 良い戦略と悪い戦略を見分ける

3. **スキャンを自動化できる**
   - 複数銘柄を一度にスキャン
   - 買いシグナルが出た銘柄だけ表示
   - 分析時間を3時間 → 10分に短縮

4. **自分の戦略を持つ**
   - データで裏付けられた売買ルール
   - 感覚ではなく、実績に基づく判断
   - 継続的に改善できる仕組み

5. **半自動化トレーディング**
   - 完全自動ではないが、手間は最小限
   - 最終判断は人間（ユウタ）が行う
   - ツールが候補を絞り込んでくれる

## 使えるようになるツール

### メインツール（新規）

- **`analysis/indicators/custom_signal.py`**（作成する）
  - カスタム指標の実装
  - RSI + MACD + ボリンジャーバンドの複合判定

- **`analysis/backtest.py`**（新規作成）
  - 戦略のバックテスト
  - パフォーマンス評価
  - 勝率、リターン、ドローダウン計算

- **`tools/scanner.py`**（新規作成）
  - 複数銘柄の自動スキャン
  - 買いシグナル検出
  - ポートフォリオ推奨

### サブツール（復習）

- **`analysis/indicators/`プラグインシステム**（Week 2）
  - 新しい指標を追加
  - 自動的にロード

- **`correlation_analyzer.py`**（Week 3）
  - ポートフォリオ最適化

## 身につく知識・スキル

### 技術的知識

1. **カスタム指標の作成**
   - 既存指標の組み合わせ
   - 独自のロジック実装
   - Pythonでの関数定義

2. **バックテスト**
   - 過去データでの検証
   - パフォーマンス指標の理解
   - 勝率、シャープレシオ、最大ドローダウン

3. **戦略評価**
   - 良い戦略と悪い戦略の見分け方
   - オーバーフィッティングの回避
   - サンプル外テスト

4. **自動化の基礎**
   - スクリプトの作成
   - バッチ処理
   - 結果の可視化

5. **継続的改善**
   - 戦略のイテレーション
   - データに基づく最適化
   - パフォーマンス追跡

### メンタル・マインドセット

1. **システマティックな思考**
   - 感覚ではなく、データに基づく判断
   - 再現可能な戦略

2. **検証の重要性**
   - 思いつきではなく、バックテストで確認
   - 失敗から学ぶ

3. **効率化の追求**
   - 時間を節約するツール作り
   - 自動化できることは自動化

## 登場人物の成長

### ユウタの現状（Week 4開始時）

**資金**: 110円（Week 3終了時）

**スキル**:
- ✅ 材料収集（crypto_analyst.py）
- ✅ 技術指標分析（timeseries_storage.py）
- ✅ 相関分析（correlation_analyzer.py）
- ✅ ポートフォリオ思考
- ❌ カスタム指標の作成方法を知らない
- ❌ バックテストの方法を知らない
- ❌ 毎回3時間かかる分析作業

**メンタル**:
- 分散投資の有効性を実感
- しかし、毎回の分析が面倒
- 「もっと効率的にできないか？」と考えている

### ユウタの到達点（Week 4終了時）

**資金**: 約135-155円（目標）

**スキル**:
- ✅ カスタム指標を作成できる
- ✅ バックテストで戦略を検証できる
- ✅ スキャンを自動化できる
- ✅ 自分の戦略を持つ
- ✅ 分析時間を10分に短縮

**メンタル**:
- システマティックな思考
- データで裏付けられた自信
- 継続的改善のマインドセット

### ミコが教えること

1. **プラグインシステムの活用**
   - `analysis/indicators/`の使い方
   - カスタム指標の作成方法

2. **バックテストの基礎**
   - 過去データでの検証
   - パフォーマンス指標の見方

3. **自動化スクリプトの作成**
   - scanner.pyの実装
   - 効率化のテクニック

4. **戦略の評価と改善**
   - 良い戦略の条件
   - オーバーフィッティングの回避

## Week 4のストーリーライン

### Act 1: 手作業の限界（20%）
- ユウタが毎週3時間かけて分析していることに疲れる
- ミコが「自動化しろ」とアドバイス
- プラグインシステムとバックテストの紹介

### Act 2: カスタム指標の作成（25%）
- `analysis/indicators/custom_signal.py`を作成
- RSI + MACD + ボリンジャーバンドの複合判定
- 最初は失敗するが、イテレーションで改善

### Act 3: バックテストで検証（30%）
- `analysis/backtest.py`を使って戦略をテスト
- 過去30日で勝率60%を達成
- オーバーフィッティングを回避する方法を学ぶ

### Act 4: 自動化と実践（25%）
- `tools/scanner.py`で複数銘柄を自動スキャン
- 買いシグナルが出た銘柄に投資
- 分析時間を3時間 → 10分に短縮
- 成功体験を積む

## 前のWeekからの繋がり

### Week 3で学んだこと（復習）
- 相関分析（correlation_analyzer.py）
- 分散投資
- ポートフォリオ思考

### Week 4での発展
- 手動分析 → 半自動化
- 既存指標 → カスタム指標
- 感覚的判断 → データで検証された戦略

## 次のWeekへの伏線

### Week 5で学ぶこと（予告）
- リアルタイム監視
- アラート機能
- より高度な自動化

### Week 4からの繋がり
- バックテスト（Week 4）→ リアルタイム適用（Week 5）
- 半自動化（Week 4）→ より完全な自動化（Week 5）

---

## 文字数目安と構成

**目標文字数**: 10,000文字以上

### Part 1: ストーリー導入（1,500文字）
- Scene 1: 手作業の疲労
- Scene 2: ミコの提案
- Scene 3: プラグインシステムの可能性

### Part 2: カスタム指標の作成（2,000文字）
- 2.1 プラグインシステムの仕組み
- 2.2 custom_signal.pyの作成
- 2.3 複合指標のロジック
- 2.4 テストと改善

### Part 3: バックテストの基礎（2,000文字）
- 3.1 バックテストとは
- 3.2 backtest.pyの実装
- 3.3 パフォーマンス指標の理解
- 3.4 オーバーフィッティングの回避

### Part 4: 自動化スクリプト（1,500文字）
- 4.1 scanner.pyの作成
- 4.2 複数銘柄の自動スキャン
- 4.3 買いシグナル検出
- 4.4 ポートフォリオ推奨

### Part 5: 実践パート（1,500文字）
- 5.1 カスタム指標で取引
- 5.2 バックテストの結果
- 5.3 実際のトレードでの成果

### Part 6: あなたの実践ガイド（2,500文字）
- 6.1 カスタム指標作成の詳細手順
- 6.2 バックテストの実例10個
- 6.3 自動化スクリプトのテンプレート
- 6.4 トラブルシューティング

### Part 7: まとめと振り返り（1,000文字）
- 7.1 学んだことリスト
- 7.2 ユウタの成長
- 7.3 次のWeekへの予告

---

**次のステップ**: ステップ2（詳細な骨子を作成）
