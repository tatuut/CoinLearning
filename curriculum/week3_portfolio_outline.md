# Week 3: 複数銘柄の比較分析 - ポートフォリオ思考を学ぶ

## このWeekの概要

Week 2では「1銘柄の技術分析」を学びました。RSI、MACD、ボリンジャーバンドを使って、個別銘柄の買い時・売り時を判断できるようになりました。しかし、実際の取引では**複数の銘柄から最適な1つを選ぶ**必要があります。

Week 3では、**複数銘柄の比較分析**を学びます。相関分析、ベータ値、リスク分散などの概念を理解し、「どの銘柄が今一番いいか」を客観的に判断できるようになります。また、複数銘柄に分散投資する「ポートフォリオ思考」も学びます。

ユウタは現在95円の資金を持っています。今週は、1銘柄に全額投資するのではなく、**リスクを分散しながら効率的に資金を増やす**方法を体得します。

## 最終ゴール

このWeekが終わった時点でできること：

1. **`correlation_analyzer.py`を使いこなす**
   - 複数銘柄の相関関係を可視化できる
   - どの銘柄がBTCと連動しているか分かる
   - 独立して動く銘柄を見つけられる

2. **相関分析を理解して使える**
   - 相関係数（-1～+1）の意味を理解
   - 高相関銘柄（0.7以上）と低相関銘柄（0.3以下）を区別
   - 分散投資に最適な銘柄の組み合わせを選べる

3. **ベータ値でリスクを測定**
   - β > 1: ハイリスク・ハイリターン
   - β < 1: ローリスク・ローリターン
   - 自分のリスク許容度に合わせた銘柄選択

4. **ポートフォリオ思考**
   - 1銘柄に全額投資しない
   - 相関の低い銘柄を組み合わせる
   - リスク分散で安定したリターン

5. **複数銘柄の比較分析**
   - 5-10銘柄を一度にスキャン
   - 技術指標 + 相関 + ベータで総合判断
   - 最適な銘柄を効率的に見つける

## 使えるようになるツール

### メインツール（新規）
- **`analysis/correlation_analyzer.py <銘柄1> <銘柄2> ...`**
  - 複数銘柄の相関行列を計算
  - ベータ値の算出
  - 分散投資の推奨組み合わせ

### サブツール（復習）
- **`data/timeseries_storage.py --test <銘柄>`**（Week 2）
  - 技術指標の一括計算

- **`crypto_analyst.py <銘柄>`**（Week 1）
  - 材料の一括取得

## 身につく知識・スキル

### 技術的知識

1. **相関係数（Correlation Coefficient）**
   - 2つの銘柄の価格変動の連動性
   - +1: 完全に同じ動き
   - 0: 無関係
   - -1: 完全に逆の動き
   - 目安: 相関 > 0.7は高相関、< 0.3は低相関

2. **ベータ値（β）**
   - 市場全体（BTC）との連動度
   - β = 1: BTCと同じリスク
   - β > 1: BTCより変動が激しい（ハイリスク）
   - β < 1: BTCより変動が穏やか（ローリスク）

3. **分散投資（Diversification）**
   - 複数の銘柄に資金を分ける
   - 相関の低い銘柄を組み合わせる
   - 1つが下がっても、他でカバー

4. **ポートフォリオリスク**
   - 個別銘柄リスクの合計 ≠ ポートフォリオリスク
   - 相関が低いほど、リスクが減る
   - 効率的フロンティア（最適なリスク・リターン比）

5. **シャープレシオ（Sharpe Ratio）**
   - リターン ÷ リスク
   - 数値が高いほど「効率的」
   - ポートフォリオの良し悪しを判断

### メンタル・マインドセット

1. **分散思考**
   - 1銘柄に全額投資しない
   - 「卵を1つのカゴに盛らない」

2. **市場との相対比較**
   - 個別銘柄の絶対評価だけでなく、他との比較

3. **リスクとリターンのバランス**
   - ハイリターンだけを追わない
   - 安定性も重視

## 登場人物の成長

### ユウタの現状（Week 3開始時）

**資金**: 95円（Week 2終了時）

**スキル**:
- ✅ crypto_analyst.pyで材料を集められる
- ✅ timeseries_storage.pyで技術指標を確認できる
- ✅ RSI、MACD、ボリンジャーバンド、ボラティリティを理解
- ✅ 複数の指標を組み合わせて判断できる
- ❌ 複数銘柄の比較方法を知らない
- ❌ 1銘柄ずつしか見ていない
- ❌ 分散投資の概念を知らない

**メンタル**:
- 技術指標の有効性を理解
- データで判断する習慣がついた
- しかし「どの銘柄を選ぶか」に迷いがある

### ユウタの到達点（Week 3終了時）

**資金**: 約115-130円（目標）

**スキル**:
- ✅ correlation_analyzer.pyを使いこなせる
- ✅ 相関分析でリスク分散できる
- ✅ ベータ値でリスクを測定できる
- ✅ 複数銘柄を一度に比較できる
- ✅ ポートフォリオ思考で取引できる

**メンタル**:
- 1銘柄に全額投資する怖さを理解
- 分散投資で安心感を得る
- 市場全体を俯瞰する視点

### ミコが教えること

1. **相関分析の基礎**
   - 相関係数とは何か
   - なぜ分散投資が重要か

2. **ベータ値の活用**
   - 市場との連動度
   - リスク許容度に応じた銘柄選択

3. **ポートフォリオ構築**
   - 資金配分の考え方
   - 相関の低い銘柄の組み合わせ

4. **実践での応用**
   - 5-10銘柄を一度にスキャン
   - 最適な組み合わせを選ぶ

## Week 3のストーリーライン

### Act 1: 選択の迷い（20%）
- ユウタが10銘柄を分析して選べない
- 全部良さそうに見える、どれを選ぶべきか迷う
- ミコが「1つずつ見てたら効率悪い」と指摘

### Act 2: 相関分析との出会い（25%）
- ミコがcorrelation_analyzer.pyを紹介
- 複数銘柄の相関関係を可視化
- 「同じような動きをする銘柄に複数投資しても意味がない」

### Act 3: 分散投資の実践（30%）
- 相関の低い2-3銘柄を選ぶ
- 資金を分散して投資
- 1つが下がっても他でカバーされる体験

### Act 4: ポートフォリオ思考の確立（25%）
- ベータ値でリスクを測定
- シャープレシオで効率を評価
- ユウタが自分のポートフォリオを構築

## 前のWeekからの繋がり

### Week 2で学んだこと（復習）
- 技術指標（RSI, MACD, ボリンジャーバンド）
- ボラティリティでリスク測定
- 複数指標の組み合わせ
- 1銘柄の深い分析

### Week 3での発展
- 1銘柄 → 複数銘柄の比較
- 個別リスク → ポートフォリオリスク
- 絶対評価 → 相対評価
- 集中投資 → 分散投資

## 次のWeekへの伏線

### Week 4で学ぶこと（予告）
- カスタム指標の作成（`analysis/indicators/`プラグインシステム）
- バックテストでストラテジーを検証
- 自動売買の準備

### Week 3からの繋がり
- ポートフォリオ分析（Week 3）→ 自動化とバックテスト（Week 4）
- 手動での分析（Week 3）→ 自動化されたストラテジー（Week 4）

---

## 文字数目安と構成

**目標文字数**: 10,000文字以上

### Part 1: ストーリー導入（1,500文字）
- Scene 1: 選択の迷い
- Scene 2: ミコの提案
- Scene 3: correlation_analyzer.pyとの出会い

### Part 2: 相関分析の説明（2,000文字）
- 2.1 相関係数とは
- 2.2 相関行列の読み方
- 2.3 高相関・低相関の意味
- 2.4 分散投資の原理

### Part 3: ベータ値とリスク測定（1,500文字）
- 3.1 ベータ値とは
- 3.2 市場との連動度
- 3.3 リスク許容度に応じた選択

### Part 4: ツールの使い方（1,500文字）
- 4.1 correlation_analyzer.pyの基本
- 4.2 出力の見方
- 4.3 推奨組み合わせの理解

### Part 5: 実践パート1（1,500文字）
- 5.1 10銘柄のスキャン
- 5.2 相関分析の実行
- 5.3 最適な組み合わせを発見

### Part 6: 実践パート2（1,500文字）
- 6.1 分散投資の実行
- 6.2 ポートフォリオの成果
- 6.3 リバランスの実践

### Part 7: あなたの実践ガイド（2,500文字）
- 7.1 correlation_analyzer.pyの詳細手順
- 7.2 相関分析の実例10個
- 7.3 ポートフォリオ構築のチェックリスト
- 7.4 トラブルシューティング

### Part 8: まとめと振り返り（1,000文字）
- 8.1 学んだことリスト
- 8.2 ユウタの成長
- 8.3 次のWeekへの予告

---

## ステップ2: 詳細な骨子

### Part 1: ストーリー導入（1,500文字目安）

#### Scene 1: 選択の迷い（600文字）

**ユウタの状況**:
- 月曜日の朝、資金95円でスタート
- 前週学んだ技術指標で10銘柄を分析
- BTC, ETH, XRP, ADA, DOT, LINK, AVAX, MATIC, UNI, ATOM
- どれも「買い」のシグナルが出ている

**ユウタの悩み**:
- 全部良さそうに見える
- どれを選べばいいか分からない
- 1つに全額投資するのは怖い
- でも複数買うほど資金がない（95円）

**ユウタの心理**:
- 「全部買いたい...でも無理」
- 「間違った銘柄を選んだらどうしよう」
- 分析に3時間かかったが、決められない

#### Scene 2: ミコの提案（500文字）

**ミコ登場**:
- ユウタの画面を見て「何やってんだ？」
- 10銘柄の分析結果を確認

**ミコの指摘**:
- 「1つずつ見てたら効率悪い」
- 「それに、1銘柄に全額投資とか自殺行為だぞ」
- 「複数の銘柄を比較して、分散投資しろ」

**ユウタの反応**:
- 「でも95円しかないのに、どうやって分散するの？」
- 「複数買ったら、利益も分散されちゃうじゃん」

**ミコの回答**:
- 「利益は減るかもしれないが、リスクも減る」
- 「それに、相関分析を使えば、効率的に分散できる」

#### Scene 3: correlation_analyzer.pyとの出会い（400文字）

**ミコがツールを起動**:
```bash
python analysis/correlation_analyzer.py BTC ETH XRP ADA DOT LINK AVAX MATIC UNI ATOM
```

**画面に相関行列が表示**:
- 10銘柄の相関係数がマトリックスで表示
- BTC-ETH: 0.85（高相関）
- BTC-XRP: 0.42（低相関）
- ETH-LINK: 0.78（高相関）

**ユウタの驚き**:
- 「すげー！一瞬で全部の関係が分かる！」
- 「BTCとETHって、ほぼ同じ動きしてるのか...」

**ミコの解説**:
- 「同じような動きをする銘柄に複数投資しても意味がない」
- 「相関の低い銘柄を組み合わせて、リスクを分散する」

---

### Part 2: 相関分析の説明（2,000文字目安）

#### 2.1 相関係数とは（500文字）

**ミコの説明**:
- 相関係数 = 2つの銘柄の価格変動の連動性
- -1 ～ +1の範囲で表される

**相関係数の意味**:
```
+1.0: 完全に同じ動き（片方が上がれば、もう片方も上がる）
+0.7～+1.0: 高相関（かなり似た動き）
+0.3～+0.7: 中相関（ある程度似た動き）
 0～+0.3: 低相関（あまり関係ない）
-0.3～ 0: 低負相関（やや逆の動き）
-0.7～-0.3: 中負相関（かなり逆の動き）
-1.0: 完全に逆の動き（片方が上がれば、もう片方は下がる）
```

**具体例**:
```
BTC-ETH: 0.85（BTCが上がればETHも上がる）
BTC-XRP: 0.42（BTCとXRPはあまり連動しない）
ETH-DOGE: 0.38（やや連動するが、独立した動きもある）
```

**なぜ重要か**:
- 高相関の銘柄を複数買っても、分散効果が低い
- 低相関の銘柄を組み合わせると、リスクが減る

#### 2.2 相関行列の読み方（400文字）

**相関行列とは**:
- 複数銘柄の相関を一覧表示
- 対角線は常に1.0（自分自身との相関）
- 対称行列（BTC-ETHとETH-BTCは同じ）

**実例**:
```
          BTC   ETH   XRP   ADA
BTC      1.00  0.85  0.42  0.61
ETH      0.85  1.00  0.38  0.73
XRP      0.42  0.38  1.00  0.29
ADA      0.61  0.73  0.29  1.00
```

**読み方のポイント**:
- 0.7以上: 高相関（同じグループと考える）
- 0.3以下: 低相関（別のグループと考える）
- 分散投資では、低相関の銘柄を選ぶ

#### 2.3 高相関・低相関の意味（600文字）

**高相関銘柄の例**:
```
BTC-ETH: 0.85
→ BTCが上がればETHも上がる、BTCが下がればETHも下がる
→ 両方買っても、リスク分散にならない
→ どちらか1つで十分
```

**低相関銘柄の例**:
```
BTC-XRP: 0.42
→ BTCが上がっても、XRPは独立した動き
→ BTCが下がっても、XRPは上がることもある
→ 両方買えば、リスクが分散される
```

**実際のシナリオ**:

シナリオ1: 高相関銘柄に分散投資
```
50円をBTCに、45円をETHに投資
→ BTCが-10%下落
→ ETHも-8%下落（高相関のため）
→ 両方とも損失（分散の意味がない）
```

シナリオ2: 低相関銘柄に分散投資
```
50円をBTCに、45円をXRPに投資
→ BTCが-10%下落（-5円）
→ XRPは+5%上昇（+2.25円）（低相関のため独立した動き）
→ 合計: -2.75円（損失は軽減された）
```

**ミコの教え**:
「1つが下がっても、もう1つが上がればカバーできる。これが分散投資の力だ」

#### 2.4 分散投資の原理（500文字）

**分散投資とは**:
- 複数の銘柄に資金を分ける
- リスクを減らす投資手法
- 「卵を1つのカゴに盛らない」

**なぜ有効か**:

数学的説明（簡易版）:
```
1銘柄のリスク: σ = 20%
2銘柄（相関0）のリスク: σ = 20% / √2 = 14.1%
3銘柄（相関0）のリスク: σ = 20% / √3 = 11.5%
```

**実例で理解**:

集中投資（1銘柄に全額）:
```
100円をBTCに投資
BTCが-20%下落
→ 損失: -20円（80円になる）
```

分散投資（2銘柄に半分ずつ、相関0.3）:
```
50円をBTCに、50円をXRPに投資
BTCが-20%下落、XRPが+5%上昇
→ BTC損失: -10円
→ XRP利益: +2.5円
→ 合計損失: -7.5円（92.5円）
```

**結果**: 分散投資の方が損失が少ない（-20円 vs -7.5円）

**ミコの教え**:
「リターンは減るかもしれないが、暴落時のダメージも減る。長期的には、こっちの方が安全だ」

---

### Part 3: ベータ値とリスク測定（1,500文字目安）

#### 3.1 ベータ値とは（500文字）

**ミコの説明**:
- ベータ値（β）= 市場全体（BTC）との連動度
- 市場のリスクを1としたときの、個別銘柄のリスク

**ベータ値の意味**:
```
β = 1.0: BTCと同じリスク
β > 1.0: BTCより変動が激しい（ハイリスク・ハイリターン）
β < 1.0: BTCより変動が穏やか（ローリスク・ローリターン）
```

**具体例**:
```
ETH: β = 1.15（BTCが10%動けば、ETHは11.5%動く）
XRP: β = 0.85（BTCが10%動いても、XRPは8.5%しか動かない）
DOGE: β = 1.80（BTCが10%動けば、DOGEは18%動く！）
```

**実例シナリオ**:

BTCが+10%上昇した場合:
```
ETH（β=1.15）: +11.5%
XRP（β=0.85）: +8.5%
DOGE（β=1.80）: +18%
```

BTCが-10%下落した場合:
```
ETH（β=1.15）: -11.5%
XRP（β=0.85）: -8.5%
DOGE（β=1.80）: -18%（大暴落！）
```

**ユウタの理解**:
「ベータが高いと、勝つ時は大きいけど、負ける時も大きいのか...」

#### 3.2 市場との連動度（500文字）

**市場（BTC）の動きを基準に考える**:

```
市場が上昇トレンド（強気相場）:
→ β > 1の銘柄を買う（ハイリターン狙い）

市場が下降トレンド（弱気相場）:
→ β < 1の銘柄を買う（損失を抑える）

市場が不安定（ボラティリティ高い）:
→ β < 1の銘柄を買う（安全策）
```

**実践例**:

ユウタの資金: 95円

シナリオA: 強気相場（BTCが上昇中）
```
DOGE（β=1.8）に60円、ETH（β=1.15）に35円
→ 市場が+10%なら、ポートフォリオは約+13%
→ 攻めの姿勢
```

シナリオB: 弱気相場（BTCが下降中）
```
XRP（β=0.85）に50円、ADA（β=0.9）に45円
→ 市場が-10%でも、ポートフォリオは約-8.7%
→ 守りの姿勢
```

**ミコの教え**:
「市場の状況を見て、ベータ値を使い分けろ。強気なら攻める、弱気なら守る」

#### 3.3 リスク許容度に応じた選択（500文字）

**自分のリスク許容度を知る**:

```
ハイリスク型（積極的）:
- β > 1.2の銘柄を中心に
- 大きく勝つことを優先
- 暴落覚悟

ミドルリスク型（バランス）:
- β = 0.9～1.1の銘柄を中心に
- リスクとリターンのバランス
- 安定した成長

ローリスク型（保守的）:
- β < 0.9の銘柄を中心に
- 損失を最小限に
- 着実に増やす
```

**ユウタの場合**:
- 資金: 95円（少額）
- 経験: 3週間（初心者）
- メンタル: 損失に弱い

**ミコの推奨**:
「お前は初心者だから、ローリスク～ミドルリスク型がいい」
「β < 1.1の銘柄を中心に、安定したリターンを狙え」

**ポートフォリオ例**:
```
50円: XRP（β=0.85、低リスク）
45円: ADA（β=0.9、低リスク）
合計β: 約0.87（ローリスク型ポートフォリオ）
```

---

### Part 4: ツールの使い方（1,500文字目安）

#### 4.1 correlation_analyzer.pyの基本（600文字）

**前提条件**:
- Python 3.8以上
- 必要なライブラリ: pandas, numpy, matplotlib
- データが既に収集されていること（Week 1-2で実施済み）

**基本的な使い方**:

ステップ1: データ確認
```bash
ls data/timeseries/prices/
```

データがない場合:
```bash
python data/detailed_data_collector.py BTC ETH XRP --all-intervals
python data/timeseries_storage.py --migrate
```

ステップ2: 相関分析を実行
```bash
cd C:\Users\tatut\Documents\playground\grass-coin-trader
python analysis/correlation_analyzer.py BTC ETH XRP ADA DOT
```

**期待される出力**:
```
================================================================================
相関分析: BTC, ETH, XRP, ADA, DOT
================================================================================

【相関行列】
          BTC   ETH   XRP   ADA   DOT
BTC      1.00  0.85  0.42  0.61  0.73
ETH      0.85  1.00  0.38  0.73  0.68
XRP      0.42  0.38  1.00  0.29  0.35
ADA      0.61  0.73  0.29  1.00  0.65
DOT      0.73  0.68  0.35  0.65  1.00

【ベータ値（対BTC）】
ETH: β = 1.12
XRP: β = 0.85
ADA: β = 0.94
DOT: β = 1.08

【推奨ポートフォリオ】
分散投資に最適な組み合わせ:
1. BTC + XRP（相関: 0.42）
2. ETH + XRP（相関: 0.38）
3. ADA + XRP（相関: 0.29）
```

#### 4.2 出力の見方（500文字）

**1. 相関行列セクション**:
- 全銘柄ペアの相関係数
- 0.7以上: 高相関（同じグループ）
- 0.3以下: 低相関（別のグループ）

**実例で理解**:
```
BTC-ETH: 0.85（高相関）
→ BTCとETHはほぼ同じ動き
→ 両方買っても分散効果は低い

BTC-XRP: 0.42（低相関）
→ BTCとXRPは独立した動き
→ 分散投資に最適
```

**2. ベータ値セクション**:
- 各銘柄の市場（BTC）との連動度
- β > 1: ハイリスク
- β < 1: ローリスク

**実例**:
```
ETH: β = 1.12
→ BTCが10%動けば、ETHは11.2%動く
→ やや攻めの銘柄

XRP: β = 0.85
→ BTCが10%動いても、XRPは8.5%しか動かない
→ 守りの銘柄
```

**3. 推奨ポートフォリオセクション**:
- 相関の低い組み合わせを提案
- そのまま使ってもOK
- 自分でカスタマイズしてもOK

#### 4.3 推奨組み合わせの理解（400文字）

**推奨される理由**:
- 相関が低い（< 0.5）
- リスクが分散される
- 1つが下がっても、もう1つでカバー

**例: BTC + XRP（相関0.42）**:
```
シナリオ1: BTCが+10%、XRPが+3%
→ 分散効果で安定したリターン

シナリオ2: BTCが-10%、XRPが+2%
→ 損失が軽減される

シナリオ3: BTCが+15%、XRPが-5%
→ 一方の利益で他方の損失をカバー
```

**自分でカスタマイズする場合**:
- 相関行列を見て、相関 < 0.5の組み合わせを探す
- ベータ値を見て、リスク許容度に合わせる
- 3-4銘柄に分散するとさらに効果的

---

### Part 5: 実践パート1（1,500文字目安）

#### 5.1 10銘柄のスキャン（500文字）

**ユウタの実践**:

まず、材料と技術指標で10銘柄をスキャン:
```bash
for symbol in BTC ETH XRP ADA DOT LINK AVAX MATIC UNI ATOM; do
  python crypto_analyst.py $symbol
  python data/timeseries_storage.py --test $symbol
done
```

**結果（簡略版）**:
```
BTC: RSI 45, MACD上昇, ボラ12% → 買い候補
ETH: RSI 52, MACD横ばい, ボラ14% → 中立
XRP: RSI 38, MACD上昇, ボラ16% → 買い候補
ADA: RSI 41, MACD上昇, ボラ13% → 買い候補
DOT: RSI 58, MACD横ばい, ボラ15% → 中立
LINK: RSI 35, MACD上昇, ボラ17% → 買い候補
AVAX: RSI 48, MACD上昇, ボラ18% → 買い候補
MATIC: RSI 44, MACD上昇, ボラ14% → 買い候補
UNI: RSI 39, MACD上昇, ボラ16% → 買い候補
ATOM: RSI 42, MACD上昇, ボラ15% → 買い候補
```

**ユウタの感想**:
「8銘柄が買い候補...全部買えない...どうしよう」

#### 5.2 相関分析の実行（600文字）

**ミコの指示**:
「買い候補の8銘柄で相関分析しろ」

```bash
python analysis/correlation_analyzer.py BTC XRP ADA LINK AVAX MATIC UNI ATOM
```

**出力結果**:
```
【相関行列】
          BTC   XRP   ADA  LINK AVAX MATIC  UNI ATOM
BTC      1.00  0.42  0.61  0.73  0.78  0.69  0.71  0.65
XRP      0.42  1.00  0.29  0.35  0.38  0.31  0.40  0.33
ADA      0.61  0.29  1.00  0.65  0.62  0.58  0.63  0.60
LINK     0.73  0.35  0.65  1.00  0.75  0.70  0.72  0.68
AVAX     0.78  0.38  0.62  0.75  1.00  0.73  0.76  0.70
MATIC    0.69  0.31  0.58  0.70  0.73  1.00  0.68  0.64
UNI      0.71  0.40  0.63  0.72  0.76  0.68  1.00  0.66
ATOM     0.65  0.33  0.60  0.68  0.70  0.64  0.66  1.00

【ベータ値】
XRP: β = 0.85（ローリスク）
ADA: β = 0.94
LINK: β = 1.08
AVAX: β = 1.15（ハイリスク）
MATIC: β = 1.02
UNI: β = 1.10
ATOM: β = 0.98

【推奨ポートフォリオ】
1. XRP + AVAX（相関: 0.38、リスク分散に最適）
2. XRP + LINK（相関: 0.35）
3. ADA + XRP（相関: 0.29、最も低相関）
```

**ユウタの気づき**:
「XRPが全部の組み合わせに入ってる！」
「XRPは他の銘柄と相関が低いから、分散投資に最適なのか」

#### 5.3 最適な組み合わせを発見（400文字）

**ミコの分析**:
「XRP + ADAが最も低相関（0.29）だ」
「さらに、両方ともβ < 1でローリスク」

**ポートフォリオ案**:
```
50円: XRP（β=0.85、相関基準銘柄）
45円: ADA（β=0.94、XRPと最も低相関）
合計β: 約0.89（ローリスク型）
相関: 0.29（低相関、分散効果大）
```

**ユウタの決断**:
「これで行く！」
「XRPとADAに分散投資する」

**ミコの補足**:
「いい選択だ。もし3銘柄に分散したいなら、ATOMも追加できる」
「XRP-ATOM相関: 0.33（低い）」

---

### Part 6: 実践パート2（1,500文字目安）

#### 6.1 分散投資の実行（500文字）

**ユウタの取引**:

月曜日朝、購入:
```
XRP: 50円購入（購入価格: $0.52）
ADA: 45円購入（購入価格: $0.38）
```

ルール設定:
```
利確: +15%
損切り: -10%
```

**1日目（月曜日夜）**:
```
XRP: +3%
ADA: +1%
ポートフォリオ: +2.0%
資金: 95円 → 96.9円
```

**2日目（火曜日）**:
```
XRP: -2%（合計: +1%）
ADA: +5%（合計: +6%）
ポートフォリオ: +3.2%
資金: 95円 → 98.0円
```

**ユウタの感想**:
「XRPが下がった時、ADAが上がってカバーしてくれた！」
「これが分散投資の効果か...」

**3日目（水曜日）**:
```
XRP: +8%（合計: +9%）
ADA: +3%（合計: +9%）
ポートフォリオ: +9.0%
資金: 95円 → 103.6円
```

**4日目（木曜日）**:
```
XRP: +6%（合計: +15.5%）← 利確ライン到達！
ADA: +5%（合計: +14.5%）
```

**ユウタの行動**:
XRPを売却（+7.75円）
ADAはまだホールド（あと少しで利確ライン）

#### 6.2 ポートフォリオの成果（600文字）

**5日目（金曜日）**:
```
ADA: +2%（合計: +16.8%）← 利確ライン超え！
```

ADAを売却（+7.56円）

**最終結果**:
```
開始資金: 95円

XRP:
- 投資額: 50円
- 利確: +7.75円（+15.5%）

ADA:
- 投資額: 45円
- 利確: +7.56円（+16.8%）

合計利益: +15.31円
終了資金: 110.31円
週間リターン: +16.1%
```

**もし1銘柄に集中投資していたら**:

シナリオA: XRPのみに95円投資
```
利益: 95円 × 15.5% = +14.73円
終了資金: 109.73円
```

シナリオB: ADAのみに95円投資
```
利益: 95円 × 16.8% = +15.96円
終了資金: 110.96円
```

**ユウタの気づき**:
「分散投資でも、集中投資とほぼ同じリターン！」
「でも、途中でXRPが下がった時、ADAでカバーされた安心感があった」
「これが分散投資のメリットか...」

**ミコの解説**:
「今回はどっちも上がったから、リターンはほぼ同じだった」
「でも、もし1つが暴落してたら、分散投資の方が圧倒的に有利だったはず」
「長期的には、分散投資の方が安定する」

#### 6.3 リバランスの実践（400文字）

**ミコが新しい概念を教える**:

「ポートフォリオは、定期的にリバランスする必要がある」

**リバランスとは**:
- ポートフォリオの比率を元に戻すこと
- 例: 50:45の比率が、成長後に55:45になった場合、50:50に戻す

**ユウタの次の投資**:

新資金: 110円

```
55円: XRP（50%）
55円: ADA（50%）
```

**ミコの追加アドバイス**:
「次は、3銘柄に分散してみるか？」
「XRP + ADA + ATOM（3つとも低相関）」
「35円ずつ投資すれば、さらにリスク分散できる」

**ユウタ**:
「次はそうする！」

---

### Part 7: あなたの実践ガイド（2,500文字目安）

#### 7.1 correlation_analyzer.pyの詳細手順（800文字）

**前提条件**:
- Python 3.8以上
- 必要なライブラリ:
  ```bash
  pip install pandas numpy matplotlib seaborn
  ```

**ステップ1: データが既にあるか確認**
```bash
ls data/timeseries/prices/
```

必要な銘柄のデータがない場合:
```bash
# 複数銘柄を一度に収集
python data/detailed_data_collector.py BTC --all-intervals
python data/detailed_data_collector.py ETH --all-intervals
python data/detailed_data_collector.py XRP --all-intervals
python data/detailed_data_collector.py ADA --all-intervals
python data/detailed_data_collector.py DOT --all-intervals

# Parquet形式に変換
python data/timeseries_storage.py --migrate
```

**ステップ2: 相関分析を実行**
```bash
cd C:\Users\tatut\Documents\playground\grass-coin-trader
python analysis/correlation_analyzer.py BTC ETH XRP ADA DOT
```

**オプション**:
```bash
# 特定の期間を指定
python analysis/correlation_analyzer.py BTC ETH XRP --days 30

# 相関行列をヒートマップで可視化
python analysis/correlation_analyzer.py BTC ETH XRP ADA DOT --heatmap

# 結果をファイルに保存
python analysis/correlation_analyzer.py BTC ETH XRP > correlation_result.txt
```

**期待される出力**:
```
================================================================================
相関分析: BTC, ETH, XRP, ADA, DOT
期間: 30日間
================================================================================

【相関行列】
（省略）

【ベータ値（対BTC）】
（省略）

【推奨ポートフォリオ】
（省略）
```

**もしエラーが出たら**:
```
エラー: "No such file or directory: 'data/timeseries/prices/XXX_1d.parquet'"
→ データがありません。ステップ1を実行してください。

エラー: "ValueError: All arrays must be of the same length"
→ データの期間が異なります。全銘柄で同じ期間のデータが必要です。
   --days オプションで期間を短くしてください。
```

#### 7.2 相関分析の実例10個（1,000文字）

**実例1: 高相関ペア（避けるべき）**
```
銘柄: BTC + ETH
相関: 0.85
ベータ: BTC (1.0), ETH (1.12)

判断: 高相関なので分散効果が低い ✗
理由: BTCが下がればETHも下がる
推奨: どちらか1つだけ買う
```

**実例2: 低相関ペア（推奨）**
```
銘柄: BTC + XRP
相関: 0.42
ベータ: BTC (1.0), XRP (0.85)

判断: 低相関で分散効果が高い ✓
理由: BTCが下がってもXRPは独立した動き
推奨: 分散投資に最適
```

**実例3: 最低相関ペア（最も推奨）**
```
銘柄: XRP + ADA
相関: 0.29
ベータ: XRP (0.85), ADA (0.94)

判断: 最も低相関、分散効果が最大 ✓✓
理由: ほぼ独立した動き
推奨: ポートフォリオの核として使用
```

**実例4: ハイリスク・ハイリターン**
```
銘柄: DOGE + SHIB
相関: 0.72
ベータ: DOGE (1.80), SHIB (2.10)

判断: 高相関 + 高β、超ハイリスク ✗✗
理由: 両方とも暴落する可能性が高い
推奨: 初心者は避ける
```

**実例5: バランス型ポートフォリオ**
```
銘柄: ETH + XRP + ADA
相関: ETH-XRP (0.38), ETH-ADA (0.73), XRP-ADA (0.29)
ベータ: ETH (1.12), XRP (0.85), ADA (0.94)
ポートフォリオβ: 0.97（1/3ずつ投資）

判断: バランスが良い ✓
理由: 適度に分散、リスクも適度
推奨: 初心者～中級者向け
```

**実例6: 守りのポートフォリオ**
```
銘柄: XRP + ADA + ATOM
相関: 全て < 0.35（低相関）
ベータ: XRP (0.85), ADA (0.94), ATOM (0.98)
ポートフォリオβ: 0.92

判断: ローリスク、守りに最適 ✓
理由: 全てβ < 1、相関も低い
推奨: 初心者、リスク回避型向け
```

**実例7: 攻めのポートフォリオ**
```
銘柄: AVAX + LINK + UNI
相関: 0.70-0.76（高め）
ベータ: AVAX (1.15), LINK (1.08), UNI (1.10)
ポートフォリオβ: 1.11

判断: ハイリスク、攻めの姿勢 △
理由: 相関が高め、β > 1
推奨: 経験者、強気相場のみ
```

**実例8: 避けるべき組み合わせ**
```
銘柄: BTC + ETH + LINK
相関: 全て > 0.70（高相関）
ベータ: BTC (1.0), ETH (1.12), LINK (1.08)

判断: 分散効果がほぼゼロ ✗
理由: 全て同じような動き
推奨: 1つだけ選ぶ
```

**実例9: 3銘柄バランス型**
```
銘柄: BTC + XRP + ADA
相関: BTC-XRP (0.42), BTC-ADA (0.61), XRP-ADA (0.29)
ベータ: BTC (1.0), XRP (0.85), ADA (0.94)
ポートフォリオβ: 0.93

判断: バランスが良く、安定 ✓
理由: BTCを基準に、低相関銘柄を追加
推奨: 標準的なポートフォリオ
```

**実例10: 上級者向け5銘柄分散**
```
銘柄: BTC + XRP + ADA + ATOM + DOT
相関: XRPを中心に低相関
ベータ: 平均0.94
ポートフォリオβ: 0.94

判断: 高度な分散、安定性が非常に高い ✓✓
理由: 5銘柄に分散、リスク最小化
推奨: 資金が十分ある場合
```

#### 7.3 ポートフォリオ構築のチェックリスト（400文字）

**取引前チェック**:
- [ ] 複数銘柄（5-10銘柄）をスキャン
- [ ] crypto_analyst.py で材料確認
- [ ] timeseries_storage.py で技術指標確認
- [ ] 買い候補を3-5銘柄に絞る
- [ ] correlation_analyzer.py で相関分析
- [ ] 相関 < 0.5の組み合わせを選ぶ
- [ ] ベータ値を確認（自分のリスク許容度に合わせる）
- [ ] 資金配分を決定（2-3銘柄に分散）
- [ ] ルール（利確・損切り）を設定

**取引中チェック**:
- [ ] 1日1-2回価格を確認
- [ ] ルールに達したら即実行
- [ ] ポートフォリオ全体の損益を記録

**取引後チェック**:
- [ ] 各銘柄の成果を記録
- [ ] ポートフォリオ全体のリターンを計算
- [ ] 相関が機能したか振り返る
- [ ] 次回への改善点をメモ

**定期チェック（週1回）**:
- [ ] ポートフォリオの比率を確認
- [ ] リバランスが必要か判断
- [ ] 新しい銘柄を追加/削除するか検討

#### 7.4 トラブルシューティング（300文字）

**Q1: データが足りない**
```
エラー: "ValueError: All arrays must be of the same length"

解決:
# 全銘柄で同じ期間のデータを収集
python data/detailed_data_collector.py BTC --interval 1d --days 30
python data/detailed_data_collector.py ETH --interval 1d --days 30
（省略）
python data/timeseries_storage.py --migrate
```

**Q2: 相関が計算できない**
```
問題: 相関係数がNaN

原因: データが不足（14行未満）

解決:
# より長い期間のデータを収集
--days 60 を使用
```

**Q3: 推奨ポートフォリオがない**
```
問題: 「推奨ポートフォリオがありません」

原因: 全銘柄が高相関

解決:
# より多様な銘柄を追加
XRP, ADA, ATOM などの低相関銘柄を含める
```

**Q4: ベータ値がおかしい**
```
問題: β > 3 または β < -1

原因: データの異常値

解決:
# データを再収集
python data/detailed_data_collector.py <銘柄> --all-intervals
python data/timeseries_storage.py --migrate
```

---

### Part 8: まとめと振り返り（1,000文字目安）

#### 8.1 学んだことリスト（400文字）

**技術的スキル**:
1. correlation_analyzer.pyの使い方
   - 複数銘柄の相関分析
   - ベータ値の計算
   - 推奨ポートフォリオの生成

2. 相関分析の理解
   - 相関係数（-1～+1）の意味
   - 高相関・低相関の区別
   - 分散投資への応用

3. ベータ値の活用
   - 市場との連動度
   - リスク許容度に応じた選択

4. ポートフォリオ構築
   - 資金配分の考え方
   - リバランスの実践

**メンタル・マインドセット**:
1. 分散思考
   - 1銘柄に全額投資しない
   - 「卵を1つのカゴに盛らない」

2. 市場との相対比較
   - 個別銘柄の絶対評価だけでなく、他との比較

3. 長期的視点
   - 短期的なリターンより、長期的な安定性

#### 8.2 ユウタの成長（300文字）

**Week 3開始時**:
- 資金: 95円
- 1銘柄ずつの分析
- 複数銘柄の比較方法を知らない

**Week 3終了時**:
- 資金: 110円（+15円、+16%）
- ポートフォリオ思考確立
- 相関分析を使いこなせる

**最大の学び**:
- 「分散投資でリスクを減らせる」
- 「相関の低い銘柄を組み合わせる」
- 「1つが下がっても、他でカバーできる安心感」

**ユウタの言葉**:
「最初は『分散したら利益も減る』と思ってた」
「でも実際は、リスクが減って安心感があった」
「次からは、絶対に分散投資する」

#### 8.3 次のWeekへの予告（300文字）

**ミコ**:
「Week 3で、ポートフォリオ思考が身についたな」
「複数銘柄を比較して、最適な組み合わせを選べるようになった」
「でも、まだ足りない」

**ユウタ**:
「えっ、まだ何か？」

**ミコ**:
「今は、毎回手動で分析してるよな？」
「銘柄をスキャンして、相関分析して...めんどくさくないか？」

**ユウタ**:
「...確かに、毎回3時間くらいかかる」

**ミコ**:
「Week 4では、カスタム指標を作って、バックテストする」
「自分だけの売買ルールを作って、過去データで検証する」
「そして、自動化の準備をする」

**ユウタ**:
「自動化...！それってボットみたいなやつ？」

**ミコ**:
「そう。まだ完全自動じゃないが、半自動化はできる」
「お前だけの『必勝パターン』を見つけるんだ」

**ユウタ**:
「やってみたい！」

---

**次のステップ**: ステップ3（骨子を一つずつ埋めていく）
