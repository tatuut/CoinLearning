# Week 3: MACD実践マスター - トレンドを見極める

**前提**: [Week 2](./02_rsi_practical.md)でRSI実践完了

**所要時間**: 3-4時間

---

## 登場人物

**あなた（tatut）** - Week 2でRSIをマスター
**ミコ** - AIトレーダー（Claude Code）、MACDの使い方を教える

---

## 📖 Part 1: Week 2の振り返り（事前ストーリー）

### Scene 1: 1週間後

**ミコ**: 「Week 2で、RSIを使った分析はどうだった？」

**あなた**: 「...まあまあ」

**ミコ**: 「RSIは『買われすぎ・売られすぎ』を教えてくれる」

**ミコ**: 「でも、『上がるのか、下がるのか』は教えてくれない」

**あなた**: 「...確かに」

**ミコ**: 「今日は、**トレンドの方向**を見極める武器を手に入れる」

---

## 🗣️ 対話ポイント1：現在のポートフォリオを確認

**ミコ**: 「まず、今のポートフォリオを見せてくれ」

👉 **あなたの番です**

**教えてほしいこと**:
- 現在保有している銘柄（すべて）
- 各銘柄の購入価格
- 現在の価格
- 損益

**例**:
```
「DOGE: 購入 $0.15, 現在 $0.16 (+6.7%)
 SHIB: 購入 $0.000020, 現在 $0.000019 (-5.0%)」
```

---

## 📊 Part 2: あなたのデータでMACD分析（ここはClaude生成）

※ **あなたがポートフォリオを教えてくれたら、ここに分析を生成します**

**生成される内容**:
- 各銘柄の現在のMACD状態
- ゴールデンクロス/デッドクロス判定
- RSIと組み合わせた総合判断
- アクションプラン

**例**:
```
ミコ: 「じゃあ、各銘柄のMACDを見てみよう」

[実際のデータ取得]
DOGE:
  MACD: 0.000325
  Signal: 0.000280
  Histogram: +0.000045 (プラス！)
  判定: ゴールデンクロス（上昇トレンド継続中）
  RSI: 58.3（中立）

ミコ: 「DOGEはMACD > Signal。ヒストグラムもプラスだ」
ミコ: 「上昇トレンドが続いてる。まだ持ってていいな」

SHIB:
  MACD: -0.00000012
  Signal: -0.00000008
  Histogram: -0.00000004 (マイナス)
  判定: デッドクロス（下降トレンド）
  RSI: 72.3（買われすぎ）

ミコ: 「SHIBはMACD < Signal。しかもRSI 72で買われすぎだ」
ミコ: 「...これは損切りを考えた方がいいかもな」
```

---

## 🗣️ 対話ポイント2：アクションを決めよう

**ミコ**: 「MACD分析を見て、どうする？」

**選択肢**:
1. **DOGEを保持**: 上昇トレンド継続
2. **SHIBを損切り**: 下降トレンド + RSI買われすぎ
3. **新しい銘柄を探す**: ゴールデンクロス直後の銘柄

👉 **あなたの判断を聞かせてください**

---

## 📚 Part 3: MACDの発明ストーリー（事前ストーリー）

### Scene 2: 1970年代後半、ニューヨーク

**ミコ**: 「MACDを発明した男の話をしよう。ジェラルド・アペルだ」

---

### 【回想シーン: アペルの問題意識】

**場所**: ニューヨーク、投資顧問会社のオフィス

**アペル** (投資アナリスト):
「クライアントから毎日同じ質問を受ける...」

**クライアント**: 「今、買い時ですか？売り時ですか？」

**アペル**: 「それに答えるのが俺の仕事だ」

**アペル**: 「でも...どうやって**客観的に**答える？」

*机の上には移動平均線を引いたチャート*

**アペル**: 「移動平均線は使ってる。短期線と長期線のクロスで判断してる」

```
【移動平均線のクロス戦略】

ゴールデンクロス（買いシグナル）:
短期移動平均線が長期移動平均線を下から上に突き抜ける

デッドクロス（売りシグナル）:
短期移動平均線が長期移動平均線を上から下に突き抜ける
```

**アペル**: 「でも、これには問題がある...」

---

### 移動平均線の限界

**アペル**: （チャートを睨む）

```
【移動平均線の3つの問題】

## 問題1: シグナルが遅い
クロスが発生した時には、トレンドがかなり進んでいる
→ 利益の大部分を逃す

## 問題2: ダマシが多い
横ばい相場（レンジ相場）では、何度もクロスが発生
→ 無駄な売買で手数料負け

## 問題3: 「強さ」がわからない
クロスが「強気」なのか「弱気」なのか判断できない
→ 自信を持ってクライアントに勧められない
```

**アペル**: 「移動平均線は『方向』は教えてくれる」

**アペル**: 「でも、『勢い』は教えてくれない」

**アペル**: 「...勢いを可視化できないか？」

---

### 閃き - 「差」に着目

**アペル**: （ペンを走らせる）

```
【思考プロセス】

現状:
短期移動平均線（12日）
長期移動平均線（26日）

観察:
- 上昇トレンド: 短期 > 長期（差が拡大）
- 下降トレンド: 短期 < 長期（差が拡大、マイナス）
- 横ばい: 短期 ≈ 長期（差が縮小）

着想:
2本の線を見るのではなく...
「差」そのものを見ればいいのでは？

定義:
MACD Line = EMA(12) - EMA(26)
（EMA = 指数移動平均）
```

**アペル**: 「これだと、1本の線になる」

**アペル**: 「上昇 = プラス、下降 = マイナス」

**アペル**: 「...でも、まだ足りない」

**アペル**: 「『買い時』『売り時』をもっと明確にしたい」

---

### シグナル線の追加

**アペル**: 「MACD自体も上下する」

**アペル**: 「じゃあ...MACDの移動平均を取ったら？」

```
【第2の着想】

Signal Line = EMA(MACD, 9)
→ MACDの9日間移動平均

判断基準:
- MACD > Signal: 上昇勢い増加 → 買いシグナル
- MACD < Signal: 下降勢い増加 → 売りシグナル
```

**アペル**: 「...これだ！」

**アペル**: （過去のチャートで検証）

**アペル**: 「クロスのタイミングが、移動平均線より早い！」

**アペル**: 「しかも、ダマシが少ない！」

---

### ヒストグラムの発明（後日談）

**ナレーション**:
数年後、トーマス・アスプレイというトレーダーが、MACDをさらに改良した。

**アスプレイ**: 「MACDとSignal Lineの差を、棒グラフにしたらどうだろう？」

```
【ヒストグラムの追加】

Histogram = MACD - Signal

視覚的効果:
- 棒が伸びる: 勢いが強まっている
- 棒が縮む: 勢いが弱まっている
- 棒がゼロをクロス: トレンド転換
```

**ナレーション**:
こうして、現代のMACD（3本セット）が完成した。

---

### Scene 3: 現代、tatutとミコ

**あなた**: 「...なるほど」

**ミコ**: 「アペルは、『勢い』を可視化したかった」

**ミコ**: 「そして、移動平均線の『差』に着目した」

**あなた**: 「シンプルだな」

**ミコ**: 「じゃあ、実装を見よう」

---

## 💻 Part 4: MACDの実装と理解

### Pythonでの実装

```python
def calculate_macd(prices: pd.Series,
                   fast_period: int = 12,
                   slow_period: int = 26,
                   signal_period: int = 9) -> pd.DataFrame:
    """
    MACD（Moving Average Convergence Divergence）を計算

    Args:
        prices: 終値のSeries
        fast_period: 短期EMA期間（デフォルト12）
        slow_period: 長期EMA期間（デフォルト26）
        signal_period: シグナル線期間（デフォルト9）

    Returns:
        DataFrame（macd, signal, histogram）
    """
    # EMA計算
    ema_fast = prices.ewm(span=fast_period, adjust=False).mean()
    ema_slow = prices.ewm(span=slow_period, adjust=False).mean()

    # MACD Line
    macd = ema_fast - ema_slow

    # Signal Line
    signal = macd.ewm(span=signal_period, adjust=False).mean()

    # Histogram
    histogram = macd - signal

    return pd.DataFrame({
        'macd': macd,
        'signal': signal,
        'histogram': histogram
    })
```

**ミコ**: 「EMAは指数移動平均。最近の価格を重視する」

---

### EMA vs SMA

```
【EMA vs SMA】

SMA（単純移動平均）:
= (直近N日の合計) / N
→ 全ての日が同じ重み

EMA（指数移動平均）:
= 前日のEMA × (1 - α) + 今日の価格 × α
→ 最近の価格ほど重視

メリット:
SMAより反応が早い
→ トレンド変化を素早く捉える
```

---

### MACDの解釈関数

```python
def interpret_macd(macd_value: float, signal_value: float, histogram: float) -> dict:
    """
    MACD値を解釈

    Returns:
        {
            'trend': 'bullish' | 'bearish',
            'signal': 'buy' | 'sell' | 'hold',
            'strength': 0.0-1.0,
            'description': '説明文'
        }
    """
    if histogram > 0:
        # ゴールデンクロス（上昇トレンド）
        return {
            'trend': 'bullish',
            'signal': 'buy' if histogram > macd_value * 0.1 else 'hold',
            'strength': min(histogram / abs(macd_value) if macd_value != 0 else 0, 1.0),
            'description': f'ゴールデンクロス。上昇トレンド継続中。Histogram={histogram:.8f}'
        }
    else:
        # デッドクロス（下降トレンド）
        return {
            'trend': 'bearish',
            'signal': 'sell' if histogram < macd_value * 0.1 else 'hold',
            'strength': min(abs(histogram) / abs(macd_value) if macd_value != 0 else 0, 1.0),
            'description': f'デッドクロス。下降トレンド。Histogram={histogram:.8f}'
        }
```

---

## 🎓 Part 5: MACDの高度な使い方

### 1. ヒストグラムの変化に注目

```
【ヒストグラムのパターン】

## パターン1: 拡大
Histogram: +0.01 → +0.02 → +0.03
→ 上昇トレンド加速中

## パターン2: 縮小
Histogram: +0.03 → +0.02 → +0.01
→ 上昇トレンド減速（反転の可能性）

## パターン3: ゼロクロス
Histogram: +0.01 → 0 → -0.01
→ トレンド転換
```

---

### 2. MACDダイバージェンス

```
【MACDダイバージェンス】

## 弱気ダイバージェンス
価格: 高値更新 📈
MACD: 高値更新せず 📉
→ 上昇の勢いが弱まっている

## 強気ダイバージェンス
価格: 安値更新 📉
MACD: 安値更新せず 📈
→ 下降の勢いが弱まっている
```

---

### 3. ゼロラインクロス

```
【ゼロラインの意味】

MACD > 0:
短期EMA > 長期EMA
→ 上昇トレンド

MACD < 0:
短期EMA < 長期EMA
→ 下降トレンド

ゼロクロス:
トレンドの大きな転換
→ 重要なシグナル
```

---

### 4. RSIとMACDの組み合わせ

**ミコ**: 「RSIとMACDを組み合わせると、さらに強力になる」

```
【RSI + MACDの組み合わせ】

## 強い買いシグナル
✅ RSI < 30（売られすぎ）
✅ MACDゴールデンクロス
✅ Histogram拡大中
→ 反発の可能性大

## 強い売りシグナル
❌ RSI > 70（買われすぎ）
❌ MACDデッドクロス
❌ Histogram縮小中
→ 調整の可能性大

## 見送り
⚠️ RSI中立、MACDデッドクロス
→ 様子見
```

---

## 🗣️ 対話ポイント3：新しい銘柄を探そう

**ミコ**: 「ゴールデンクロス直後の銘柄を探してみるか？」

👉 **あなたの番です**

**やること**:
1. MEXCのランキングやSNSで気になる銘柄を探す
2. ダッシュボードでMACD確認
3. ゴールデンクロス直後の銘柄を教えてください

**例**:
```
「ミコ、LINKが気になる。MACDがゴールデンクロスしたみたい」
```

---

## 📊 Part 6: 新しい銘柄の分析（ここはClaude生成）

※ **あなたが銘柄を教えてくれたら、ここに分析を生成します**

**生成される内容**:
- MACDの現在の状態
- RSIとの組み合わせ判定
- ボリンジャーバンドも考慮
- 総合スコア
- 買うべきか判断

---

## 📝 Week 3のまとめ

### 今回学んだこと

1. **自分のデータでMACD分析**
   - 保有銘柄のトレンド確認
   - ゴールデンクロス/デッドクロス判定

2. **MACDの発明ストーリー**
   - アペルの問題意識
   - 移動平均線の「差」に着目
   - シグナル線とヒストグラムの追加

3. **MACDの計算方法**
   - EMA(12) - EMA(26)
   - Signal = EMA(MACD, 9)
   - Histogram = MACD - Signal

4. **高度な使い方**
   - ヒストグラムの変化
   - MACDダイバージェンス
   - ゼロラインクロス
   - RSIとの組み合わせ

5. **実践的判断**
   - RSI + MACDで総合判断
   - 単体では使わない

---

## ✅ Week 3 完了チェックリスト

- [ ] 現在のポートフォリオのMACD分析
- [ ] ゴールデンクロス/デッドクロス判定
- [ ] MACDの発明ストーリーを理解
- [ ] MACDの計算方法を理解
- [ ] ヒストグラムの意味を理解
- [ ] RSIとMACDの組み合わせを理解
- [ ] 新しい銘柄のMACD分析
- [ ] アクションプランを決定

---

## 🎓 次のステップ

**Week 4**: ボリンジャーバンド + 統合分析
- ボラティリティの理解
- RSI + MACD + BBの三位一体
- 総合スコアリングシステム

---

## 📚 参考資料

- [Week 0: 基礎知識](./00_foundations.md) - MACDの基本
- [Week 2: RSI実践](./02_rsi_practical.md) - RSI復習
- [docs/ANALYSIS_METHODS.md](../docs/ANALYSIS_METHODS.md) - MACDの詳細な数式
- [Streamlitダッシュボード](../dashboard/main.py) - MACDの可視化

---

## 🎓 復習クイズ

### Q1: MACDのゴールデンクロスとは？
<details>
<summary>答えを見る</summary>
MACD線がSignal線を**下から上**に抜けること。上昇トレンドの始まりを示す。
</details>

### Q2: Histogramがプラスからマイナスに転じた。これは？
<details>
<summary>答えを見る</summary>
**デッドクロス発生**。MACDがSignalを下抜けた。下降トレンドの始まり。
</details>

### Q3: RSI 65、MACDゴールデンクロス。どうする？
<details>
<summary>答えを見る</summary>
**買い検討**。RSIはまだ買われすぎではなく（70未満）、MACDは上昇トレンド。ただし、他の指標（ニュース、出来高）も確認。
</details>

### Q4: EMAとSMAの違いは？
<details>
<summary>答えを見る</summary>
**EMA（指数移動平均）は最近の価格を重視**。SMA（単純移動平均）は全期間を同じ重みで扱う。EMAの方が反応が早い。
</details>

---

**次のステップ**: [Week 4: 統合テクニカル分析](./04_integrated_technical.md)

---

**最終更新**: 2025-11-02
**作成者**: Claude Code (with tatut)
